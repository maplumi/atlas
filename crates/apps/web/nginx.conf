server {
    listen 9103;
    listen [::]:9103;

    server_name _;

    # Allow large file uploads (up to 1 GB).
    client_max_body_size 1024m;

    root /usr/share/nginx/html;
    index index.html;

    # IMPORTANT: avoid serving stale builds.
    # `index.html` is the SPA entrypoint and changes the hashed asset URLs.
    # If it gets cached, the browser can keep loading an old JS/WASM bundle.
    location = /index.html {
        add_header Cache-Control "no-store, no-cache, must-revalidate, proxy-revalidate, max-age=0" always;
        try_files $uri =404;
    }

    # Hashed assets are safe to cache aggressively.
    location ~* \.(?:js|wasm|css|png|jpg|jpeg|gif|svg|ico|webp|avc)$ {
        add_header Cache-Control "public, max-age=31536000, immutable" always;
        try_files $uri =404;
    }

    # Single-page app fallback (Trunk builds with hashed assets).
    location / {
        try_files $uri $uri/ /index.html;
    }
}
